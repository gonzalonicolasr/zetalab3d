<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test Modal & OAuth Fixes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üß™ Test Modal & OAuth Fixes</h1>
            <p>Esta p√°gina permite probar las correcciones realizadas:</p>
            
            <div style="margin: 20px 0;">
                <h3>üé≠ Test Modal/Popup Fixes</h3>
                <p>Verifica que los modales se vean correctamente sin blur conflicts:</p>
                <button id="testModal" class="primary">Abrir Modal de Prueba</button>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>üîê Test OAuth Implementation</h3>
                <p>Verifica que el OAuth funcione correctamente:</p>
                <button id="testGoogleOAuth" style="background: #4285f4; color: white; margin: 5px;">Test Google OAuth</button>
                <button id="testFacebookOAuth" style="background: #1877f2; color: white; margin: 5px;">Test Facebook OAuth</button>
            </div>
            
            <div style="margin: 20px 0;">
                <h3>üìä Status & Debug</h3>
                <div id="debugInfo" style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px;">
                    Cargando...
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <a href="index.html" class="pill">‚Üê Volver al Login</a>
            </div>
        </div>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="subscription-service.js"></script>
    
    <script>
        // Initialize Supabase
        const supabase = window.supabase.createClient(
            "https://fwmyiovamcxvinoxnput.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3bXlpb3ZhbWN4dmlub3hucHV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNzAzODksImV4cCI6MjA3MTc0NjM4OX0.x94-SZj7-BR9CGMzeujkjyk_7iItajoHKkGRgIYPUTc"
        );
        window.supa = supabase;

        // Test modal functionality
        document.getElementById('testModal').onclick = () => {
            const modal = document.createElement('div');
            modal.className = 'subscription-modal';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.closest('.subscription-modal').remove()"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üß™ Modal Test - Fixed Blur Issues</h2>
                        <button onclick="this.closest('.subscription-modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
                    </div>
                    <div style="padding: 20px;">
                        <h3>‚úÖ Fixes aplicados:</h3>
                        <ul style="text-align: left;">
                            <li>‚Ä¢ Z-index corregido (100000+)</li>
                            <li>‚Ä¢ Backdrop-filter optimizado (3px)</li>
                            <li>‚Ä¢ Modal content sin backdrop-filter</li>
                            <li>‚Ä¢ Will-change para performance</li>
                        </ul>
                        <p><strong>¬øSe ve claramente este texto sin blur?</strong></p>
                        <button onclick="this.closest('.subscription-modal').remove()" class="primary">Cerrar Modal</button>
                    </div>
                </div>
            `;
            
            // Apply fixed styles
            modal.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                z-index: 200000 !important;
                display: block !important;
                opacity: 1 !important;
            `;
            
            document.body.appendChild(modal);
        };

        // Test OAuth functions
        const testOAuth = async (provider) => {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.innerHTML += `<br>üîÑ Testing ${provider} OAuth...`;
            
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: provider,
                    options: {
                        redirectTo: `${window.location.origin}/calculadora.html`,
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent',
                        }
                    }
                });
                
                if (error) {
                    debugDiv.innerHTML += `<br>‚ùå ${provider} Error: ${error.message}`;
                } else {
                    debugDiv.innerHTML += `<br>‚úÖ ${provider} OAuth initiated successfully`;
                }
            } catch (err) {
                debugDiv.innerHTML += `<br>üí• ${provider} Exception: ${err.message}`;
            }
        };

        document.getElementById('testGoogleOAuth').onclick = () => testOAuth('google');
        document.getElementById('testFacebookOAuth').onclick = () => testOAuth('facebook');

        // Show debug info
        (async () => {
            const debugDiv = document.getElementById('debugInfo');
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                debugDiv.innerHTML = `
                    <strong>üîß Debug Information:</strong><br>
                    ‚Ä¢ Supabase Client: ${supabase ? '‚úÖ Loaded' : '‚ùå Not loaded'}<br>
                    ‚Ä¢ Subscription Service: ${window.subscriptionService ? '‚úÖ Loaded' : '‚ùå Not loaded'}<br>
                    ‚Ä¢ Current User: ${session ? `‚úÖ ${session.user.email}` : '‚ùå Not authenticated'}<br>
                    ‚Ä¢ URL: ${window.location.href}<br>
                    ‚Ä¢ Hash: ${window.location.hash || 'None'}<br>
                    ‚Ä¢ User Agent: ${navigator.userAgent.substring(0, 50)}...<br>
                    ‚Ä¢ Online: ${navigator.onLine ? '‚úÖ Yes' : '‚ùå No'}<br>
                    <br><strong>üéØ Test Results:</strong>
                `;
                
                if (session && window.subscriptionService) {
                    const hasActive = await window.subscriptionService.hasActiveSubscription(session.user.id);
                    debugDiv.innerHTML += `<br>‚Ä¢ Active Subscription: ${hasActive ? '‚úÖ Yes' : '‚ùå No'}`;
                }
                
            } catch (error) {
                debugDiv.innerHTML = `‚ùå Error loading debug info: ${error.message}`;
            }
        })();
    </script>
</body>
</html>